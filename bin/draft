#!/bin/zsh
set -eu -o pipefail

args=(
    --height=70%
    --min-height=10
    --header=some-header  # TODO get from server
    # TODO --query=...
    --tiebreak=index
    --scheme=history
    # TODO --tac for reverse?
    --read0
    --info=inline-right
    --highlight-line
    --delimiter=\\x1f  # TODO is this working?
    --with-nth=2..
    --nth=2..
    --preview-window=down:10:wrap
    --preview='python -m draft preview {1}'
    --print0
    --print-query
    --bind 'start:execute-silent(python -m draft serve &)+reload(python -m draft backwards)'
    # --bind 'tab:reload(python -m draft fast --next $mode)'  # TODO support modes
    --bind 'enter:become(python -m draft exit --index {1})'
    --bind 'esc:become(python -m draft exit --fail)'
    --bind 'ctrl-c:become(python -m draft exit --fail)'
)
unshare -r -n fzf $args
